# TP2023-DBMS-Project
Семестровый проект по дисциплине "СУБД"
В качестве семестрового проекта нужно разработать сервер приложения, реализующий rest api из этой спецификации:<br>
<a href="https://github.com/mailcourses/technopark-dbms-forum/blob/master/swagger.yml" target="_blank">https://github.com/mailcourses/technopark-dbms-forum/blob/master/swagger.yml</a>
<ul>
	<li>субд - PostgreSQL, чем более новая версия, тем лучше, но только стабильные релизы;</li>
	<li>язык любой;</li>
	<li>фрэймворк любой;</li>
	<li>драйвер для СУБД любой (если пишете на Go, рекомендую <a href="https://github.com/jackc/pgx">https://github.com/jackc/pgx</a>);</li>
	<li>не советую использовать orm, так как велика вероятность, что не потянете нагрузочное тестирование;</li>
</ul>
<br>
<a href="https://github.com/mailcourses/technopark-dbms-forum" target="_blank">https://github.com/mailcourses/technopark-dbms-forum</a> - репозиторий с тестирующей программой, разобраться в нем, научиться компилить и запускать - тоже часть вашей задачи по разработке проекта!<br>
<br>
<strong>Важное требование:</strong><br>
весь DDL базы: таблицы, индексы, представления, триггеры, хранимые процедуры и функции и тп должны лежать в одном файле: db/db.sql. Так как ваш проект не подразумевает инкрементального наката на сервер, а каждый раз клонируется и собирается с нуля, то и смысла делить на несколько файлов миграций нет.<br>
<br>
Отдельных дедлайнов для всех видов тестирования проекта нет, но сдаются они последовательно. То есть нагрузочное тестирование не будет оцениваться пока не будет пройдено функциональное тестирование.<br>
 <br>
Баллы начисляются по следующему принципу:
<ul>
	<li>40 rps за балл, но не более 30 баллов</li>
	<li>Если результат устраивает, то нужно написать мне в телеграм: "Я студент(ка) &lt;Фамилия Имя&gt;, вот мой репозиторий &lt;ссылка&gt;, баллы устраивают, хочу сдать проект"</li>
	<li>Я посмотрю содержимое файла db/db.sql, задам вопросы и после получения удовлетворительных ответов проставлю данные в ведомость.</li>
</ul>
Особенности проведения тестов:

<ul>
	<li>Все проверки проходят последовательно;</li>
	<li>Docker-контейнеру установлено ограничение по количеству используемой оперативной памяти в 2Gb 
	<pre>docker run -d --memory 2G --log-opt max-size=5M --log-opt max-file=3 --name park_perf -p 5000:5000 park</pre>
	</li>
	<li>На сборку контейнера отводится не более 15-ти минут - аккуратно и внимательно настраивайте .dockerignore;</li>
	<li>На заполнение базы отводится не более 15-ти минут;</li>
	<li>Нагрузка идёт 10 раз в течение 1-ой минуты в 8 потоков. Учитывается лучший результат.</li>
	<li>Ограничение на размер репозитория 5MB аккуратно и внимательно настраивайте .gitignore. Если закоммитите что-то большое, например, скомпиленный бинарь, то придется чистить историю, либо пересоздавать репозиторий!</li>
</ul>
 
<h3>Как сдавать:</h3>
<a href="https://docs.google.com/spreadsheets/d/1Mp8P0H3u8mw9O69EJCaEP62Ib8TkDuI5luUdvB4ssqE/edit#gid=0" target="_blank">Ссылка на гугл таблицу</a><br>
Доступы к гуглдоку выдал на email, которые есть у меня в ведомостях, если нужно выдать доступ на другой адрес, то переходите по ссылке и отправляйте запрос, если в течение часа-двух я не выдам доступ - пишите в телеграм.<br>
<br>
План такой:
<ol>
	<li>напротив своей фамилии вписываете ссылку на репозиторий на гитхабе, в формате https://github.com/&lt;user&gt;/&lt;repo&gt; ничего дополнительного в ссылке быть не должно!</li>
	<li>локально проверяете работоспособность сборки и тестов (подробнее в конце поста)</li>
	<li>ставите статус в файле <strong>func</strong> или <strong>perf</strong></li>
	<li>каждый час скрипт парсит файлик и ставит в очередь на сборку все работы в статусе <strong>func</strong> и <strong>perf</strong>. Частоту парсинга можно по необходимости увеличивать, просто раз в час, это идеально, чтобы не пробить лимит гугл апи.</li>
	<li>статусы:
	<ol>
		<li><strong>idle</strong> - требуется действие от студента, либо просто поменять статус, либо исправить ошибку и поменять статус</li>
		<li><strong>func</strong> - будет запущено только функциональное тестирование</li>
		<li><strong>perf</strong> - будет запущено функциональное и нагрузочное тестирование</li>
		<li><strong>processing</strong> - проект прямо сейчас тестируется. <strong>Служебный статус, руками не трогать!</strong></li>
		<li><strong>enqueued</strong> - работа поставлена в очередь на сборку. <strong>Служебный статус, руками не трогать!</strong></li>
	</ol>
	</li>
	<li>по завершению сборки работа переходит в статус idle и результаты отображаются в колонках Результаты тестирования и Информация о сборке</li>
</ol>
Основные грабли:<br>
Перед сдачей на стэнде проверьте следующее:
<ol>
	<li>Последняя версия проекта должна успешно клонироваться командой: <em>git clone --single-branch "&lt;ссылка на ваш репозиторий&gt;" </em></li>
	<li>Проект должен успешно собираться командой: <em>docker build --no-cache -t park</em></li>
	<li>Репозиторий с тестирующей программой: https://github.com/mailcourses/technopark-dbms-forum
	<ol>
		<li>проверьте локально функциональное тестирование: <em>./technopark-dbms-forum func -u http://localhost:5000/api -r report.html</em></li>
		<li>проверьте заполнение базы: <em>./technopark-dbms-forum fill --url=http://localhost:5000/api --timeout=900</em> Если у вас слабый компьютер, то увеличьте таймаут для локально сборки, но обязательно добейтесь хоть раз полного заполнения, чтобы ловить ошибки на стэнде!</li>
		<li>проверьте нагрузочное тестирование: .<em>/technopark-dbms-forum perf --url=http://localhost:5000/api --duration=600 --step=60</em></li>
	</ol>
	</li>
</ol>
Возможные ошибки и их причины:

<ol>
	<li><strong>Не удалось заполнить базу</strong> - этап заполнения упал по таймауту, нужно оптимизировать заполнение базы, следите за избыточными индексами</li>
	<li><strong>Произошла ошибка во время нагрузочного тестирования</strong> - проверяйте нагрузочное тестирование локально и ищите ошибку</li>
	<li><strong>Не удалось собрать Docker-контейнер</strong> - проверяйте, что проект корректно клонируется и собирается командами описанными выше</li>
	<li><strong>Не удалось получить данные из репозитория</strong> - что-то не так со ссылкой на репозиторий или с правами доступа к нему, проверьте, что он успешно клонируется командой выше </li>
</ol>
Срок сдачи - до 25.06.2023<br>
